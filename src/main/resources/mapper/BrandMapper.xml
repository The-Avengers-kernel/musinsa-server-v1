<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.avengers.musinsa.mapper.BrandMapper">
    <select id="selectRecentVisitedBrands" parameterType="long" resultType="com.avengers.musinsa.domain.brand.dto.BrandDto">
        SELECT
            brandId,
            brandName,
            brandEngName,
            brandImageUrl
        FROM (
                 SELECT DISTINCT
                     b.BRAND_ID AS brandId,
                     b.BRAND_NAME_KR AS brandName,
                     b.BRAND_NAME_ENG AS brandEngName,
                     b.BRAND_IMAGE AS brandImageUrl,
                     MAX(rvb.BRAND_VIEW_TIME) AS maxViewTime
                 FROM recent_visited_brands rvb
                          JOIN brands b ON rvb.BRAND_ID = b.BRAND_ID
                 WHERE rvb.USER_ID = #{userId}
                 GROUP BY b.BRAND_ID, b.BRAND_NAME_KR, b.BRAND_NAME_ENG, b.BRAND_IMAGE
                 ORDER BY maxViewTime DESC
             )
    </select>

    <!--카테고리 - 브랜드 목록 전체 조회-->
    <select id="getBrandList"
            resultType="com.avengers.musinsa.domain.brand.dto.response.BrandResponse">
        SELECT brand_id as brandId,
               brand_name_kr as brandNameKr,
               brand_name_eng as brandNameEn,
               brand_image as brandImage
        FROM brands
        ORDER BY BRAND_LIKES DESC, brand_name_kr ASC
    </select>

    <!--카테고리 - 카테고리 별로 브랜드 목록 조회-->
    <select id="getBrandsByCategoryId"
            resultType="com.avengers.musinsa.domain.brand.dto.response.BrandByCategoryResponse">
        SELECT bc.brand_category_id as brandCategoryId,
               bc.category_name as categoryName,
               b.brand_id as brandId,
               b.brand_name_kr as brandNameKr,
               b.brand_name_eng as brandNameEn,
               b.brand_image as brandImage
        FROM brands b
            JOIN brand_has_categories bhc ON b.BRAND_ID = bhc.BRAND_ID
            JOIN brand_categories bc ON bc.brand_category_id = bhc.brand_category_id
        WHERE bc.BRAND_CATEGORY_ID = #{categoryID}
    </select>
</mapper>



        <!--최근 검색 브랜드는 검색 로그만 사용--> <!--상품 조회 기록과는 별개-->
<!--데이터 소스 연결 필수-->





